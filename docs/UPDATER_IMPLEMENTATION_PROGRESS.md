# Tauri 应用更新功能实现进度

## 项目概述

为 KnowledgeFocus Tauri 应用实现基于 GitHub Releases 的自动更新功能。

## 总体目标

- [x] 配置 Tauri updater 插件（已完成）
- [x] 前端更新检查和状态管理 ✅ 已完成
- [x] 侧边栏红点提示功能 ✅ 已完成
- [x] 设置页面更新功能 ✅ 已完成
- [ ] 发版流程和工具

## 实施步骤

### 第一阶段：前端基础功能 🚧

#### 步骤 1: 检查和安装依赖

- [x] 1.1 检查 package.json 中的 updater 插件依赖 ✅ 发现缺失，需要安装
- [x] 1.2 检查权限配置 (capabilities) ✅ 已正确配置 "updater:default"
- [x] 1.3 安装缺失的依赖 ✅ 已安装 @tauri-apps/plugin-updater@2.9.0

#### 步骤 2: 创建更新状态管理

- [x] 2.1 扩展 Zustand store 添加更新相关状态 ✅ 已添加完整的更新状态管理
- [x] 2.2 创建更新检查 hook/service ✅ 已创建 useUpdater hook
- [x] 2.3 实现定时检查机制（每天一次） ✅ 已实现自动检查和持久化存储

#### 步骤 3: 侧边栏更新提示

- [x] 3.1 分析 app-sidebar.tsx 结构 ✅ 已分析，找到 SidebarHeader 位置
- [x] 3.2 添加红点提示组件 ✅ 已创建 UpdateBadge 组件
- [x] 3.3 连接更新状态 ✅ 已在侧边栏中集成并初始化更新检查

#### 步骤 4: 设置页面更新功能

- [x] 4.1 分析 settings-about.tsx 结构 ✅ 已分析现有结构
- [x] 4.2 添加手动检查更新按钮 ✅ 已添加完整的更新UI
- [x] 4.3 实现下载进度显示 ✅ 已添加进度条和状态显示
- [x] 4.4 添加重启应用功能 ✅ 已实现重启按钮功能

### 第二阶段：发版流程和工具 🚧

#### 步骤 5: 测试更新功能 (MOCK 模式)

- [x] 5.1 创建测试用的 latest.json 文件 ✅ 已创建并可访问
- [x] 5.2 修改配置支持本地测试 ✅ 开发环境指向本地文件
- [x] 5.3 验证 JSON 文件可访问性 ✅ 通过 curl 验证成功
- [x] 5.4 测试更新检查功能 ✅ 手动检查正常，红点提示正常
- [ ] 5.5 测试完整下载安装流程（需要真实 release）
- [ ] 5.6 测试重启功能

#### 步骤 6: 创建发版工具

- [ ] 6.1 创建 latest.json 生成脚本
- [ ] 6.2 优化构建流程
- [ ] 6.3 编写发版操作手册

## 当前配置状态

### ✅ 已完成

- Tauri updater 配置 (tauri.conf.json)
- 公钥配置
- GitHub endpoint 配置
- 构建脚本配置 (build.sh)
- 版本同步脚本 (sync-version.sh)

### 🔍 待确认

- 前端依赖是否完整
- 权限配置是否正确

## 实施记录

### 2025-01-03

- 创建实施计划
- 开始第一阶段实施

---

## 注意事项

1. 每完成一个步骤都要测试验证
2. 有问题及时停下来讨论
3. 保持代码简洁和可维护性
